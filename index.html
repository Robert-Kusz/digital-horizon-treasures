<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Digital Horizon Treasures</title>

<!-- PWA -->
<meta name="theme-color" content="#000000">
<link rel="manifest" href="/manifest.json">

<!-- OneSignal -->
<script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  background: linear-gradient(180deg, #0b0b0b, #000);
  color: gold;
  text-align: center;
}

header {
  padding: 22px;
  font-size: 1.6rem;
  border-bottom: 1px solid rgba(255,215,0,.35);
}

nav {
  position: sticky;
  top: 0;
  background: #000;
  padding: 12px;
  display: flex;
  justify-content: center;
  gap: 10px;
}

nav a {
  padding: 10px 14px;
  border-radius: 20px;
  border: 1px solid rgba(255,215,0,.4);
  color: gold;
  text-decoration: none;
  font-size: .85rem;
}

.button {
  display: block;
  margin: 16px auto;
  padding: 16px;
  width: 85%;
  max-width: 360px;
  background: #000;
  border-radius: 14px;
  border: 1px solid rgba(255,215,0,.4);
  color: gold;
  font-size: 1rem;
  cursor: pointer;
}

iframe {
  width: 100%;
  height: 75vh;
  border: none;
}

#pushStatus {
  font-size: .8rem;
  opacity: .8;
}

/* Install prompt */
#installHelp {
  background:#000;
  border:1px solid gold;
  padding:14px;
  margin:12px;
  border-radius:12px;
  font-size:.85rem;
}
</style>
</head>

<body>

<!-- INSTALL PROMPT -->
<div id="installHelp">
  üì≤ <strong>Install for LIVE alerts</strong><br>
  iPhone: Tap <strong>Share ‚¨ÜÔ∏è</strong> ‚Üí <strong>Add to Home Screen</strong>
</div>

<header>üíé Digital Horizon Treasures</header>

<!-- NOTIFICATION BUTTON -->
<div class="button" id="notifyBtn" onclick="enablePush()">
  üîî Enable Notifications
</div>
<p id="pushStatus">Tap to enable notifications for LIVE alerts</p>

<nav>
  <a href="#shop">üõçÔ∏è Shop</a>
  <a href="https://www.tiktok.com/@digital.horizon.p">üé• TikTok LIVE</a>
</nav>

<section id="shop">
  <iframe src="https://www.digitalhorizonphotography.co.uk/shop/" loading="lazy"></iframe>
  <a class="button" href="https://www.digitalhorizonphotography.co.uk/shop/" target="_blank">
    üîó Open Full Shop
  </a>
</section>

<script>
/* ---------- HELPERS ---------- */
function isIOS() {
  return /iphone|ipad|ipod/i.test(navigator.userAgent);
}

function isStandalone() {
  return (
    window.matchMedia('(display-mode: standalone)').matches ||
    window.navigator.standalone === true
  );
}

/* ---------- SERVICE WORKER ---------- */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}

/* ---------- ON LOAD LOGIC ---------- */
window.addEventListener("load", () => {
  const installHelp = document.getElementById("installHelp");
  const notifyBtn = document.getElementById("notifyBtn");

  // Initialise OneSignal
  window.OneSignal = window.OneSignal || [];
  OneSignal.push(function () {
    OneSignal.init({
      appId: "55439cf3-66fa-44a2-adf1-8c97cd0b88b3",
      notifyButton: { enable: false }
    });
  });

  // iOS installed app
  if (isIOS() && isStandalone()) {
    localStorage.setItem("appInstalled", "true");
    if (installHelp) installHelp.style.display = "none";
    if (notifyBtn) notifyBtn.innerText = "üîî Enable Notifications";
    return;
  }

  // iOS but not installed
  if (isIOS() && !isStandalone()) {
    if (installHelp) installHelp.style.display = "block";
    if (notifyBtn) notifyBtn.innerText = "üì≤ Install app to enable notifications";
    return;
  }

  // Non-iOS devices
  if (installHelp) installHelp.style.display = "none";
});

/* ---------- ENABLE PUSH ---------- */
function enablePush() {
  if (isIOS() && !isStandalone()) {
    alert("Please install the app first:\nShare ‚Üí Add to Home Screen");
    return;
  }

  if (!window.OneSignal || !OneSignal.push) {
    alert("Push system still loading, please wait a moment.");
    return;
  }

  OneSignal.push(function () {
    OneSignal.isPushNotificationsEnabled().then(function (enabled) {
      if (enabled) {
        document.getElementById("pushStatus").innerText =
          "‚úÖ Notifications already enabled";
      } else {
        OneSignal.registerForPushNotifications();
        document.getElementById("pushStatus").innerText =
          "üì≤ Check the permission prompt";
      }
    });
  });
}
</script>

</body>
</html>
